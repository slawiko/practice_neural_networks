Итог работы - двухслойная Char-RNN, каждый слой состоит из LSTM ячеек размером 256 скрытых слоев (так и не понял, почему эти юниты называют скрытыми слоями).
Обучение проходит мини-батчами по 300 строк. Каждая строка длиной в 100 символов. Embedding size 128. Оптимизировал в этот раз алгоритмом Adam, потому что на предыдущей лабе уже после дедлайна попробовал и был удивлен: accuracy был значительно (около 5 процентов) выше.
Так же, как и в предыдущей лабе, написал early stopper, который смотрит на уменьшение лоса: если не уменьшается 500 эпох - стопаем и используем лучшую на данный момент (по лоссу) модель.
Обучал на русском тексте "Мастер и Маргарита" [`master_and_margarita.txt`]('../data/char-rnn/master-and-margarita.txt'). Изначально скачал этот текст с какого-то сайта, после чего слегка почистил его: поискал странные кавычки, странные символы, странные тире и на основе чистого текста построил словарь. То есть словарь заточен под датасет.
Не понял как при генерации текста использовать стейт ячеек с предыдущей генерации. В `tf.nn.dynamic_rnn` отдаю `initial_state=None` во всех модах кроме обучения. То есть уверенности, что стейт ячеек действительно как-то где-то используется в обученной модели, у меня не было. Поэтому генерировал текст посимвольно, каждый раз на генерацию отдавая увеличенный (от последнего рана генерации) текст, чтобы контекст сохранялся (по крайней мере в моем понимании).

Помимо этого периодически проверял прогресс модели (на первых степах генерировал по 100 доволнительных символов, позднее стал по 500):

```
===
Разрешите мне присесть?  ееоо то а аоион о  ооеоо е оаеое ео ооеота но е воое оо еоко аеа сое оео аа ое но оеа оо еоеоно ва
===
Разрешите мне присесть? - порол веко вето в поролали валила в пололел и но верел породал валел поролалал на постол вела в о
===
Разрешите мне присесть? - во выстал в сторовать подолать на стровал в постоло в пороверила породал в присластор в просторов
===
Разрешите мне присесть? - простольно собел в летей в стретно сама не следил в которов страть в подверил в подомном столовик
===
Разрешите мне присесть? - постростно в которой сколать в семень сторов столько подвела он пододновить придела водно по веревил в половал в коловечно поделал и подовом не поредала в породолько на столов в комном сверание поделил в породел все стольно на сверной с подельно стала в поредной вы столовой подновие востель и придел в стал воростенно отверил и подолной посла половел ваше не столова все стала вы подалая в просет поделил водерном слове и поделал на сомоне в сколовая в котором в соменно не столанно в стольно пос
===
Разрешите мне присесть? - в то вы солова в поледела в семо просили в лица сломи в подновить поделал в разам в сторонь с привертой в поделовики в стара в пострател в поредила в половой столовой половал в комнате собер в полодом с полодела в тем следал в просила в сторов в какомо столоную стольно подветил на столько половеть в селовко в сторовечно все сказал в которой сторов в поделовела в сторов, в столько он совенить в полодел подоловил в стал и в семом не светил в семонда и в полодел в стали в разголовенно подверил с
===
Разрешите мне присесть? - столовая стал потовиталь в совора в соленените сторов и придорал свети и стал в которой странно подного проверить не собранил и свосто на стать в подомонной сторонно и стала в серенный сторов и стать в столого столько в совершенные следно в старать востренно с вертой стал в семунде в проверновался в кого не постолинно и все вы стала стал в домом светельно пришившись в только в просил в терень проверил в сторонно стала в свостельно проколько и не на стал на столько в семной с полтарить в темер
===
Разрешите мне присесть? - поделал в семон подоллования с подняли в собедать в слоста в сомного сторой и водом с возверенно стала в просторов с подельной под поколокой в подверила столной в полосом под сторонном в подоколом стала в камине столано с ответил собена в семного подала в комнато в корокой покоровать и поднилась в кот стола на солеца в столой в подняма сказала в подолдал в комнате под содерной под отодной странной совершина, подвавал в толом от под свасти в поделом в проследние под по водом под стать в сторон
===
Разрешите мне присесть? - сказал поднял свое свертованного стал под обверями и подумал с под воздух на сторону и стало в комнете в каменных стояли стала в своей с подверный с продорже на своем воскодной странным и страшного поднял с столой с колонну, и под покорой со столой странный кот, - сказал в том что он подошла на своем своему странный с конимами, и подложил поднялся в полнее в собой столовый под своем света страшного под под соверенным странный под селе в столонем и подлить в самой положить с восквичением и пов
===
Разрешите мне присесть? - сказал Воланд и в столбами положил в поледний положил в столь и подвел и поднялся в стороне и под столом в стеклом под полошивом поднял на полной столом в полной сторон под собовой светом в прокуратором стояли в сторону и сторону на странный под столом поднял в полной положке и последним полном которой столовения под свой столах и спрасивал себя на полоску и в столку и стали столь в себя в полном слушал в камину в самому своем получился в свой стольки и показалось и поднял в сторону, и поднял
===
Разрешите мне присесть? - ответил Иван Иванович и под столом и подлетел в том, что вы вышел не под столь в самом положила солодиться в от поднял и полагая в полной комнаты и стала в под своей каким-то подняли с самой столом и пригладела в слова и с под полувечком и поднялась в которой под стола и поднялся в колена и поднялся на своего поднял в полном слубой положение и с столом стал под собой и столь под стороном и под свои собой подкричал в своей последним в своего страника и с себе не после под себе на стороне и с к
```

Здесь очень четко стало видно, что генерировал слишком наивно: брал самый вероятный символ. Попробовал взять рандомный из 3 самых вероятных, получил вот это:
```
Разрешите мне присесть? Все и предстались недердел, кто он стал прокуратор, - она стояли совсем столь полной следенки. Она не председателя с неми полном отчелению, она собедника по ней поднял стакой пришедших, но спросите с накаждым, и по продолгованном воздухой, предсводил на поразный, как-то прокуратера приватьстве на портое поднялся воскленке и под столе под своим варное кому стали по на породничку..

- В там не следом потворять, что покойно под полу в комнате - в том скамейки. И посложа со столой вас не обнарутил 
```

Появились несуществующие слова, но хотя бы поразнообразней.

Итоговый текст, после 2100 эпох (`./model/char-rnn/1544559107`):
```
Разрешите мне присесть?

Вас не надляжно, как привинули, и в то вещих в передний в того посторонное. Никак все после того, к привелин и простовинулся, как будто в тем свою солнцем, и в корочей в переведа в какие остались сперви по патом прокуратор отделились и скажите, и с великий стал на пропел недобой, и вы на сами, выпила в том. - Все начего, как придлавшись перам с собой на нее сказал:

- Ах, ты все провершили положить не быть, что она по дверце, - пристолите в садом полным под немы положению и по страшный волос п
```

Скрипт для генерации текста [`generator.py`](./generator.py) запускать так:
```bash
> python ./generator.py ./path_to_model "Sample string[russian]" 500
```
результат допишется в файл `output.txt`.

График лосса на валидации (синий) и обучении (оранжевый) в `loss_graphic.png`
